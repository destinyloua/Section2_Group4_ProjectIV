package testing;

import java.nio.ByteBuffer;

import back_end.SocketHandler;

public class ImageReceiver {
	
	public void Receive(String savedFile) {
		try {
			//Get img size
			byte[] receivedImgSize = SocketHandler.ReceiveData();
			ByteBuffer read = ByteBuffer.wrap(receivedImgSize);
			int imageSize = read.getInt();
			System.out.println("Image received: " + imageSize + " bytes");
			
			int chunkSize = 32768;
			int dataSize = chunkSize -4;
			int totalChunk = (int) Math.ceil((double) imageSize/dataSize);
			
			byte[] imgData = new byte[imageSize];
			
			for(int i=0;i<totalChunk;i++) {
				byte[] receivedChunk = SocketHandler.ReceiveData();
				read = ByteBuffer.wrap(receivedChunk);
				
				System.out.println("Chunk #"+read.getInt()+": " + receivedChunk.length + " bytes");
				
				//Copy received img data into img bytes array (Exclude the chunk number at first 4 bytes)
				System.arraycopy(receivedChunk, 4, imgData, (receivedChunk.length*i) - 4, receivedChunk.length - 4);
			}
		}
		catch (Exception e) {
			System.out.print(e.getStackTrace());
		}

	}

	public static void main(String[] args) {
		// TODO Auto-generated method stub

	}

}
